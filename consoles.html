<html lang="es">
<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link id="gamecss" rel="stylesheet" type="text/css" href="css/game.css">
  <link rel="stylesheet" type="text/css" href="fonts/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <title>Lista de Consolas</title>

</head>

<body>
  <section>
    <h1 id='titulo'>Seleccione una consola</h1>
    <div class="container">
      <ul id="content">

      </ul>
      </a>
    </div>
    <article>
      <h1>Seleccione una consola</h1>
      <div class="container">
        <ul>
          <li class="game">
            <a href="game_01.html">
              <img class="img" src="images/playstation4_console.jpg" alt="">
              <p class="name">Playstation 4</p>
              <p class="description">
                PlayStation®4 se ha diseñado desde su concepción para garantizar que los creadores de videojuegos
                puedan
                dar rienda suelta a su imaginación y desarrollar los mejores juegos y las experiencias más
                innovadoras
                que se hayan visto nunca. <br>
                DUALSHOCK®4 presenta innovaciones para brindar experiencias de juego de mayor inmersión.
              </p>
            </a>
          </li>
          <li class="game">
            <a href="game_02.html">
              <img class="img" src="images/xbox_one_x_console.jpg" alt="">
              <p class="name">Xbox One X</p>
              <p class="description">
                La consola más potente del mundo. <br> <br>
                Con 40 % más de potencia que cualquier otra consola, podrás disfrutar de un juego en 4K
                verdaderamente
                envolvente. Los juegos simplemente se reproducen mejor en Xbox One X. <br>
                Diseñado para cada ángulo. No importa cómo lo veas, Xbox One X es elegante y distintivo.
              </p>
          </li>
          </a>
          </li>
          <li class="game">
            <a href="game_03.html">
              <img class="img" src="images/pc_gaming.jpg" alt="">
              <p class="name">PC for Gaming</p>
              <p class="description">
                Todo el mundo da por hecho que el modelo de ciclo de consolas tradicional ha muerto. Andrew House,
                CEO de
                Sony Interactive Entertainment, dijo lo siguiente en una entrevista para The Guardian: «Existe un
                punto
                en la mitad del ciclo de vida de las consolas donde, los jugadores que buscan una mejor experiencia
                gráfica, comenzarían a migrar hacia el PC».
              </p>
          </li>
          </a>
          </li>
        </ul>
        </a>
      </div>
    </article>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var contenido = document.getElementById('content');
      var consolaId; // variable para saber que consola elegimos
      var requestURL = 'jsons/game.json';
      var request = new XMLHttpRequest();
      request.open('GET', requestURL);
      request.responseType = 'json';
      request.send();

      request.onload = function () {
        var game = request.response;
        //console.log(game['console']);
        mostrarConsolas(game['console']);
        addclickConsolas(game['console']);
        //clickGames();
      }

      // ---------------------------------------------------------------------------
      function mostrarConsolas(consolas) {
        //console.log(consolas);

        consolas.forEach(function (consola, index) {
          // crear li dentro del ul
          var lista = crearLista(consola.id, 'game');
          // crear cada elemento dentro del li
          crearElemento(lista, 'img', 'img');
          crearElemento(lista, 'p', 'name');
          crearElemento(lista, 'p', 'descripcion');

          // arreglo con todos los li de clase game que representan las consolas DOM
          var game = document.getElementsByClassName('game');

          // asignar a cada variable un elementro dentro de la lista de consola DOM
          var img = game[index].getElementsByClassName('img');
          var name = game[index].getElementsByClassName('name');
          var descripcion = game[index].getElementsByClassName('descripcion');

          // rellenar datos de elementos de la lista de consola
          img[0].src = "images/console_" + consola.id + ".jpg";
          name[0].innerHTML = consola.name;
          descripcion[0].innerHTML = consola.descripcion;
        });
      }

      // ---------------------------------------------------------------------------

      function addclickConsolas(consolas) {
        // lista de consola existente en DOM para agregar evento onclick
        var consolaHTML = document.getElementsByClassName("game");

        consolas.forEach(function (consola, index) {
          // asignamos evento click a cada lista de consola
          consolaHTML[index].addEventListener("click", function () {
            // console.log ('consolas');//array de consolas
            // console.log (consolas);
            // console.log ('consola');// cada elemento del array consolas (elemento consola)
            // console.log (consola);
            // console.log ('games');//array de juegos dentro de elemento consola
            // console.log (consola['game']);
            mostrarJuegos(consola['game'], index);
          });
        });

      }
      // ---------------------------------------------------------------------------

      function addclickGames(games) {
        //console.log(games);
        // lista de consola existente en DOM para agregar evento onclick
        var gamesHTML = document.getElementsByClassName("game");

        games.forEach(function (game, index) {
          // asignamos evento click a cada lista de game
          gamesHTML[index].addEventListener("click", function () {
            // console.log(games); //array de juegos
            // console.log(game); //el juego
            mostrarDetallesJuego(game, index);
          });
        });

      }

      // ---------------------------------------------------------------------------

      function mostrarJuegos(games, index) {
        // guardamos indice de la consola clickeada
        consolaId = index;
        // vaciamos la lista ul class=game
        while (contenido.firstChild) {
          contenido.removeChild(contenido.firstChild);
        }
        // recorremos cada elemnto del arreglo juego
        games.forEach(function (juego, index) {
          // creamos li por cada juego dentro de ul
          var lista = crearLista(juego.id, 'game');
          console.log(lista);
          // arreglo que contiene los juegos
          var game = document.getElementsByClassName('game');
          // asignamos una variable id para cada juego
          var id = juego.id;
          if (juego.id < 10) {
            id = "0" + id;
          }
          // creamos cada elemento dentro del li
          console.log('contenido');
          console.log(contenido);
          var img = crearElemento(lista, 'img', 'img');
          var name = crearElemento(lista, 'p', 'name');
          var favorite = crearElemento(lista, 'div', 'favorite');
          favorite.setAttribute("id", "favorite_" + id);
          crearInput(favorite.id, 'checkbox', 'favorite' + id);
          var genre = crearElemento(lista, 'p', 'genre');
          var year = crearElemento(lista, 'p', 'year');
          var price = crearElemento(lista, 'p', 'price');
          var descripcion = crearElemento(lista, 'p', 'descripcion');

          // rellenamos los datos de cada lista de juegos 
          img.src = "images/game_0" + consolaId + "_" + id + "_01.jpg";
          name.innerHTML = juego.name;
          genre.innerHTML = juego.genre;
          year.innerHTML = juego.year;
          price.innerHTML = juego.price;
          descripcion.innerHTML = juego.description;
        });
        addclickGames(games);
      }

      // ---------------------------------------------------------------------------

      function mostrarDetallesJuego(game) {
        // quitar css anterior game.css
        var head = document.getElementsByTagName("head")[0];
        var gamecss = document.getElementById('gamecss');
        head.removeChild(gamecss);

        // asignar nuevo css game_description.css
        CargarCSS("css/game_description.css");

        // vaciamos la lista ul class=game
        while (contenido.firstChild) {
          contenido.removeChild(contenido.firstChild);
        }

        // borramos titulo
        document.getElementById('titulo').remove();

        // creamos li para cada campo del juego
        //dar formato 0x donde (x = id)
        var id = game.id;
        if (game.id < 10) {
          id = "0" + id;
        }

        //name del juego
        var name = crearElemento(contenido, 'li', 'name'); {
          // titulo h1 name
          var name_titulo = crearElemento(name, 'h1', 'titulo');
        }
        var ratings = crearElemento(contenido, 'li', 'ratings'); {
          // 5 span ratings          
          var ratings_score = game.ratings[0]['score'];
          var ratings_count = game.ratings[0]['count'];
          var star1 = crearElemento(ratings, 'span', 'fa fa-star');
          var star2 = crearElemento(ratings, 'span', 'fa fa-star');
          var star3 = crearElemento(ratings, 'span', 'fa fa-star');
          var star4 = crearElemento(ratings, 'span', 'fa fa-star');
          var star5 = crearElemento(ratings, 'span', 'fa fa-star last');
          // console.log ("score: " + ratings_score + " count: " + ratings_count);
          // console.log (star1.className);
          //asignar de acuerdo a las valoraciones
          if (ratings_score >= 1) {
            star1.className += ' checked';
          }
          if (ratings_score >= 2) {
            star2.className += ' checked';
          }
          if (ratings_score >= 3) {
            star3.className += ' checked';
          }
          if (ratings_score >= 4) {
            star4.className += ' checked';
          }
          if (ratings_score >= 5) {
            star5.className += ' checked';
          }
          // console.log(ratings);
          // console.log(ratings.firstChild);
          // console.log(ratings.lastChild);
        }
        var genre = crearElemento(contenido, 'li', 'genre');
        var year = crearElemento(contenido, 'li', 'year');
        var linea = crearElemento(contenido, 'li', 'linea')
        var img = crearElemento(contenido, 'img', 'img');
        var descripcion = crearElemento(contenido, 'li', 'descripcion'); {
          var desc_p = crearElemento(descripcion, 'p', 'desc');
        }

        // rellenamos los datos de cada lista de juegos 
        name_titulo.innerHTML = game.name;
        console.log(game.ratings);
        ratings.innerHTML += ratings_count + " Ratings";
        genre.innerHTML = game.genre;
        year.innerHTML = game.year;
        linea.innerHTML = '<hr>';
        var path_img = "images/game_0" + consolaId + "_" + id + "_02.jpg";
        img.src = path_img;
        desc_p.innerHTML = game.long_description;
      }

      // ---------------------------------------------------------------------------

      function crearLista(id, clase) {
        var li = document.createElement('li');
        li.setAttribute('id', id);
        li.setAttribute('class', clase);
        contenido.appendChild(li);
        return li;
      }

      // ---------------------------------------------------------------------------

      function crearElemento(padre, tipo, clase) {
        //var padre = document.getElementById(padreid);
        var elemento = document.createElement(tipo);
        elemento.setAttribute('class', clase);
        if (clase === 'span') {
          elemento.innerHTML = "aaaa";
        }
        padre.appendChild(elemento);
        return elemento;
      }

      // ---------------------------------------------------------------------------

      function crearInput(padreid, tipo, name) {
        var padre = document.getElementById(padreid);
        var label = document.createElement('label');
        var elemento = document.createElement('input');
        elemento.setAttribute('type', tipo);
        elemento.setAttribute('id', name);
        label.setAttribute('for', name);
        padre.appendChild(elemento);
        padre.appendChild(label);
      }

      // ---------------------------------------------------------------------------

      function CargarCSS(css_file) {
        var fileref = document.createElement("link");
        fileref.setAttribute("rel", "stylesheet");
        fileref.setAttribute("type", "text/css");
        fileref.setAttribute("href", css_file);
        document.getElementsByTagName("head")[0].appendChild(fileref);
      }

      // ---------------------------------------------------------------------------

      function calcStars(score, count, new_score) {
        //console.log ("score: " + score + " count: " + count + " new score: " + new_score);
        var temp = score * count;
        //console.log ("temp: " + temp);
        return (temp + new_score) / (count + 1);
      }

      // ---------------------------------------------------------------------------

    });
  </script>

</body>

</html>